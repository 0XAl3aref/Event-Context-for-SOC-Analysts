# Event Context for SOC team Cheatsheet

---

<aside>


## 1️⃣ What is event context ?

</aside>

## Intro :

1. **Event context** refers to the additional data and metadata surrounding a security event or log entry that provides deeper insights and understanding about that event .

1.  Event context enriches raw log data, making it more meaningful and actionable by helping security analysts understand the "who," "what," "where," "when," and "why" of a security incident.

2. Without context, an event (such as a failed login attempt or a network connection) is just raw data. By adding context, QRadar helps security teams assess the significance of the event, prioritize incidents, and take appropriate action. Context allows QRadar to correlate events across multiple sources, understand the environment, and identify patterns of potential threats.

---

<aside>


## 2️⃣ Let’s dive into the key components that define **event context** in QRadar :

</aside>

## **Raw Event Data :**

The starting point of any security event is the raw log data generated by various systems, devices, or applications. This log data typically includes:

- **Timestamp**: The date and time when the event occurred.
- **Source IP**: The IP address that originated the event.
- **Destination IP**: The IP address that is the target of the event.
- **Event Name**: A description of the event (e.g., “Failed Login” or “Network Connection Established”).
- **Log Source**: The system or device that generated the log (e.g., firewall, web server, database server).
- **Event Details**: This could include specific parameters or fields, like the username, port numbers, status code, and so on.

## However, raw event data lacks deeper meaning on its own. To make sense of this data, QRadar adds context by analyzing, enriching, and correlating it.

## **Components of Event Context in QRadar :**

### Types of context QRadar adds to events:

### **1) Asset Context :**

QRadar maintains an internal **asset database** that tracks detailed information about systems and devices within your network. This asset context helps QRadar assess how critical a device is and whether it has vulnerabilities that could be exploited.

- **Asset Identification**:
    
    QRadar identifies the source and destination devices involved in an event by mapping their IP addresses to known assets. This helps determine whether a device is a critical server, user workstation, or something else.
    
- **Vulnerability Information**:
    
     If QRadar has vulnerability scanning data (from integrated vulnerability scanners like Tenable, Rapid7 or Qualys and more ….), it can add context about known vulnerabilities on the involved asset. For example, if an event involves an asset with a high-severity unpatched vulnerability, QRadar will prioritize that event as more critical.
    
- **Asset Criticality**:
    
    QRadar assigns a criticality score to assets, indicating how important they are to the organization. An event involving a high-criticality asset (e.g., a database server containing sensitive data) will receive more attention than one involving a low-criticality asset (e.g., a regular user’s workstation).
    

### **2) Network Context (Network Hierarchy) :**

QRadar distinguishes(Identify) between internal and external traffic based on the organization’s **network hierarchy**, which defines the range of trusted IP addresses within the organization.

- **Internal vs. External**: QRadar knows which IP addresses belong to internal assets and which are external. This helps identify whether an event involves internal traffic (e.g., between two internal devices) or traffic from an external attacker.

- **Network Zones**: QRadar can also categorize traffic between different network zones, such as between trusted internal subnets and the DMZ (Demilitarized Zone), or between different departments in the organization.

> **Network zones** are categorized based on how they are configured within the system’s **Network Hierarchy**. The network hierarchy consists of IP address ranges that represent different segments of an organization’s network. These segments can be divided into zones, which are used to categorize traffic and events based on their source and destination. Categorizing zones helps QRadar determine the trust level, criticality, and potential risk of the traffic or event.
> 
- Example :
    
    **Destination Network Zone**:
    
    - **Zone Name**: Internal Network - Finance Servers
    
    **Source Network Zone**:
    
    - **Zone Name**: Internal Network - User Workstations

- **Direction of Traffic**: Context about whether traffic is incoming (external to internal), outgoing (internal to external), or lateral (internal to internal) is key for assessing the significance of an event. For example, outbound traffic to an untrusted or suspicious external destination might indicate data exfiltration.
- Example :
    
    **Traffic Direction**:
    
    - **Direction**: Internal-to-Internal (lateral movement)

### 3) User Context :

When events involve users, QRadar can correlate the event with user identity and behavior, providing a clearer picture of who is involved.

- **Username**: QRadar retrieves usernames by parsing log data from various sources like authentication systems (Active Directory, VPN, cloud services), firewalls, and applications. It extracts the usernames, correlates them across systems, and uses them in rules to detect suspicious or unauthorized activity.

- **User Roles**: QRadar can also provide context about the user's role in the organization (e.g., is the user an administrator or a regular employee?). Events involving administrators or privileged accounts are often more critical.

- **User Behavior**: QRadar tracks historical user behavior, allowing it to detect anomalies. For example, if a user is logging in from an unusual location or at an odd time of day, QRadar can flag this as suspicious.

### 4) **Time Context :**

QRadar, **time-based context** adds valuable data to events that helps the system detect patterns, trends, and anomalies over time. This context enriches events by providing insights into when the event occurred, how frequently similar events have happened within a specific time window, and how the event fits into a broader sequence of actions. Here’s the key data that time context adds to events:

1. **Timestamp Information :**
- **Event Time**: The precise time when the event occurred, typically in a **UTC** format. This includes:
    - **Start Time**: The exact moment the event began.
    - **End Time**: If applicable, the moment the event ended or was resolved.
    - **Reception Time**: When QRadar received the event.
- **Why It Matters**: Timestamps are crucial for tracking the chronological order of events, correlating multiple events, and determining whether an event is part of an ongoing attack.

1. **Event Duration :** 
- If an event spans a period of time (e.g., a network session or a file transfer), QRadar records the duration of the event.
- **Why It Matters**: Duration helps determine whether an event is significant (e.g., a long session might indicate data exfiltration) or if multiple short-duration events are part of a brute-force attempt.

1. **Event Frequency (Repeated Events) :** 
- QRadar tracks how often similar events occur within a specific time window (e.g., failed login attempts, traffic spikes, etc.).
- **Why It Matters**: If an event repeats frequently within a short time frame (e.g., multiple failed login attempts in 5 minutes), QRadar can detect brute-force attacks or DoS (Denial of Service) attempts.

1. **Correlation of Events Over Time :**
- QRadar can correlate multiple events over a set time period, identifying sequences of related actions that might indicate a larger attack or abnormal behavior. The correlation engine tracks:
    - **Series of Events**: Events that are related to each other (e.g., login attempts followed by privilege escalation).
    - **Time Windows**: Defined time windows (e.g., "last 5 minutes" or "within the last hour") where specific thresholds or patterns are monitored.
- **Why It Matters**: By correlating events over time, QRadar detects complex attack chains or persistent threats that occur over an extended period.

### 5)  **Threat Intelligence Context :**

QRadar integrates with **threat intelligence feeds** that enhances events with additional data that helps security analysts understand the nature and severity of threats related to those events. By integrating threat intelligence feeds, QRadar can provide contextual information about known threats, vulnerabilities, and indicators of compromise (IOCs). Here are the key types of data that Threat Intelligence Context adds to events:

- **Known Threat Indicators :**
    - **Malicious IP Addresses**: If the source or destination IP address of an event matches known malicious IPs from threat intelligence feeds, QRadar can flag the event accordingly. This includes IPs associated with botnets, malware, or known attack sources.
    - **Malicious URLs and Domains**: Events involving connections to URLs or domains identified as malicious can be marked with relevant threat intelligence data.

- **Severity and Confidence Levels :**

- **Threat Severity Ratings**: Events can be enhanced with a severity rating based on threat intelligence. This indicates how critical or high-risk an event might be, helping analysts prioritize their response.
- **Confidence Scores**: A confidence score can indicate how reliable the threat intelligence is. Higher scores suggest a higher likelihood that the event is genuinely associated with a threat.

- **Geolocation Data :**
    - **Threat Geolocation**: QRadar can provide geolocation information about malicious IP addresses, helping analysts identify if the traffic is originating from regions known for high cybercrime activity

### 6)Geolocation Context

**Geolocation Context** in QRadar refers to the additional data related to the geographical locations associated with IP addresses involved in events. This context can significantly enhance the analysis of security incidents by providing insights into where traffic is coming from and going to. Here’s a detailed breakdown of Geolocation Context and its components:

- **Geolocation Data Sources :**
    - **Threat Intelligence Feeds**: Some threat intelligence services also provide geolocation information as part of their datasets, indicating regions associated with malicious activity.
    
    - **Geo-IP Databases**: QRadar utilizes external Geo-IP databases (like MaxMind or IP2Location) that map IP addresses to physical locations, including country, region, city, and even latitude and longitude. These databases are updated regularly to maintain accuracy.

- **Data Added to Events :**
    - **Country and Region Information**: For each event, QRadar can add data about the originating and destination countries and regions. This helps analysts quickly understand if the traffic is domestic or international.
    
    - **City and ISP Information**: In addition to country and region, details about the specific city and Internet Service Provider (ISP) can be provided. This level of detail can be crucial for identifying suspicious activities from unusual locations.
    
    - **Latitude and Longitude**: Geolocation can also provide precise latitude and longitude coordinates, which can be useful for mapping and visualizing threats geographically.

---

<aside>


## 3️⃣ Importance of Event Context for Threat Detection and Response :

</aside>

### The event context in QRadar is critical for several key reasons:

### **Prioritization of Security Events :**

Without context, security teams could be overwhelmed by the volume of raw events and logs. Event context helps QRadar prioritize the most important events based on asset criticality, vulnerability information, and threat intelligence. This allows security teams to focus on incidents that pose the greatest risk to the organization.

### b. **Improved Detection of Complex Attacks :**

Complex attacks often involve multiple stages, and each stage may generate separate events. By correlating events and adding context, QRadar can detect broader attack patterns, such as lateral movement within a network or multi-stage attacks that unfold over time.

### c. **Faster Incident Response :**

The enriched context helps security analysts quickly understand the full scope of an event or offense. For example, knowing that an event involves a critical server with known vulnerabilities, and that the source IP has a poor reputation score, allows analysts to make faster and more informed decisions about how to respond.

### d. **Anomaly Detection :**

Event context also enables QRadar to detect anomalies in network traffic or user behavior. By comparing current events to historical data and known behavioral patterns, QRadar can identify deviations that may indicate insider threats or compromised accounts.

---

<aside>


## 4️⃣ Event Context Extraction :

</aside>

 QRadar enriches the event by providing **event context**. This enrichment happens as part of the **Custom Rule Engine (CRE)** processing and other internal QRadar mechanisms.

## **How Context is Extracted**:

- When the CRE processes an event, it matches the event's properties (such as source and destination IPs) against the **network hierarchy** and **asset database**.

- The CRE applies correlation rules, which may include threat intelligence data, asset criticality, and user behavior patterns, to determine the context of the event.

- The context (e.g., internal vs. external, critical asset involvement, malicious IP involvement) is added as **metadata** to the event record.

- **Who extracts event context**: The CRE in combination with QRadar's internal components like the network hierarchy manager, asset manager, and external integrations (e.g., vulnerability scanners, threat intelligence).

## Storage of Event Context :

Once the event has been enriched with context, both the **event properties** and **event context** are stored in QRadar’s **events database**.

### **Event Properties Storage**:

- **Event properties** are stored in a structured format within the **events database** (sometimes referred to as the Ariel database). This is where QRadar stores all ingested logs after parsing.

### **Event Context Storage**:

- The **event context** is typically stored as **additional metadata** alongside the original event properties.
- For example:
    - Whether the event involves internal or external traffic.
    - Whether the involved asset is critical or vulnerable.
    - Whether the source IP is flagged as malicious by threat intelligence.
- These enriched metadata fields are saved in the same **events database** and are available for use in searches, rule evaluations, offenses, and reports.
- **Offenses Storage**: If an event triggers a rule that leads to an offense, the offense is stored in the **offenses database**, which records contextual information about the events that contributed to the offense, the assets involved, and the correlation logic.

## Accessing Event Context :

- **Event Viewer**: When viewing events in the QRadar interface, you can see both the raw event properties and the enriched context fields. The event context helps analysts understand the significance of the event.

- **Offense Viewer**: In the offenses tab, QRadar provides a detailed breakdown of the event context, showing why an event triggered an offense and providing insights into the network and asset context.

- **Search and Correlation**: Event context is also used during searches, allowing you to filter or group events based on enriched metadata (e.g., show only events involving critical assets or external IPs).

---

<aside>


## 5️⃣ Example Flow of Event Context Extraction and Storage:

</aside>

- **Log Ingestion**: QRadar ingests a raw log from a firewall, containing a source IP, destination IP, event name (e.g., "Unauthorized Access Attempt"), and timestamp.

- **Log Parsing (DSM)**: The Device Support Module (DSM) parses the log and extracts the core event properties, such as source IP, destination IP, event type, etc.

- **Contextual Enrichment (CRE and Other Components)**:
    - QRadar checks the **network hierarchy** and determines the source IP is external and the destination IP is internal.
    - It looks up the destination IP in the **asset database** and finds that it is a critical web server.
    - It consults **threat intelligence feeds** and discovers that the source IP is associated with known malicious activity.
    
- **Rule Processing (CRE)**: Based on this context, the Custom Rule Engine applies correlation rules and determines whether to trigger an alert or offense.

- **Storage in Events Database**: Both the raw event properties and the enriched event context (e.g., internal vs. external, asset criticality, threat intelligence) are stored in the events database.

- **Offense Generation (if applicable)**: If the event meets specific rule criteria, QRadar generates an offense. The offense contains both the event properties and the enriched context to help analysts understand the significance of the threat.

---

<aside>
🧑🏻‍💻

Creator : Mohamed Saber 

</aside>
